<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <title>My Orders | THE CAFEINE Restaurant</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <a href="/" class="logo"><img src="images/logo.png" alt="Logo" /></a>
      <nav class="navbar">
        <% if (user && user.isAdmin) { %>
        <!-- Admin user: only show admin dashboard and logout -->
        <a href="/admin" style="color: #ff6b6b; font-weight: bold"
          >Admin Dashboard</a
        >
        <a href="/api/users/signout">Log Out</a>
        <% } else if (name) { %>
        <!-- Regular logged-in user: show normal navigation -->
        <a href="/">home</a>
        <a href="/#about">about</a>
        <a href="/menu">menu</a>
        <a href="/feedback">feedback</a>
        <a href="/#contact">contact</a>
        <a href="/my-orders" style="color: var(--main-color)">my orders</a>
        <a href="/api/users/signout">Log Out</a>
        <% } else { %>
        <!-- Not logged in: show public navigation -->
        <a href="/">home</a>
        <a href="/#about">about</a>
        <a href="/menu">menu</a>
        <a href="/feedback">feedback</a>
        <a href="/#contact">contact</a>
        <a href="/signin">Sign In</a>
        <% } %>
      </nav>
    </header>

    <!-- Main Content -->
    <section class="py-16 bg-gray-50 min-h-screen">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h1 class="text-4xl font-bold mb-4">My Orders</h1>
          <p class="text-gray-600">Track your recent orders and their status</p>
        </div>

        <div id="orders-container" class="max-w-4xl mx-auto">
          <div class="text-center py-8">
            <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-4"></i>
            <p class="text-gray-600">Loading your orders...</p>
          </div>
        </div>
      </div>
    </section>

    <script>
      async function loadUserOrders() {
        try {
          const response = await fetch("/api/orders/my-orders");
          const data = await response.json();

          const container = document.getElementById("orders-container");

          if (!data.success || data.data.length === 0) {
            container.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-shopping-bag text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">No orders yet</h3>
                            <p class="text-gray-500 mb-6">Start exploring our delicious menu!</p>
                            <a href="/menu" class="bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600">
                                Browse Menu
                            </a>
                        </div>
                    `;
            return;
          }

          container.innerHTML = data.data
            .map(
              (order) => `
                    <div class="bg-white rounded-lg shadow-md mb-6 p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-semibold">Order #${order._id.slice(
                                  -8
                                )}</h3>
                                <p class="text-gray-600">${new Date(
                                  order.createdAt
                                ).toLocaleString()}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm font-medium 
                                ${
                                  order.status === "pending"
                                    ? "bg-yellow-100 text-yellow-800"
                                    : order.status === "confirmed"
                                    ? "bg-blue-100 text-blue-800"
                                    : order.status === "preparing"
                                    ? "bg-orange-100 text-orange-800"
                                    : order.status === "ready"
                                    ? "bg-purple-100 text-purple-800"
                                    : order.status === "delivered"
                                    ? "bg-green-100 text-green-800"
                                    : "bg-red-100 text-red-800"
                                }">
                                ${order.status.toUpperCase()}
                            </span>
                        </div>
                        
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">Items Ordered:</h4>
                            <div class="space-y-2">
                                ${order.items
                                  .map(
                                    (item) => `
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <img src="${item.image}" alt="${
                                      item.name
                                    }" class="w-12 h-12 rounded-lg mr-3">
                                            <div>
                                                <p class="font-medium">${
                                                  item.name
                                                }</p>
                                                <p class="text-gray-600 text-sm">Qty: ${
                                                  item.quantity
                                                }</p>
                                            </div>
                                        </div>
                                        <span class="font-semibold">₹${
                                          item.price * item.quantity
                                        }</span>
                                    </div>
                                `
                                  )
                                  .join("")}
                            </div>
                        </div>
                        
                        <div class="border-t pt-4 mt-4">
                            <div class="flex justify-between items-center text-sm">
                                <span>Subtotal:</span>
                                <span>₹${order.subtotal}</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span>Delivery Fee:</span>
                                <span>₹${order.deliveryFee}</span>
                            </div>
                            <div class="flex justify-between items-center font-bold text-lg border-t pt-2">
                                <span>Total:</span>
                                <span>₹${order.total}</span>
                            </div>
                        </div>
                    </div>
                `
            )
            .join("");
        } catch (error) {
          console.error("Error loading orders:", error);
          document.getElementById("orders-container").innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Error loading orders</h3>
                        <p class="text-gray-500">Please try again later</p>
                    </div>
                `;
        }
      }

      document.addEventListener("DOMContentLoaded", loadUserOrders);
    </script>
  </body>
</html>
